<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>The Witcher</title>

    <script src="./js/sessao.js"></script>

    <link rel="stylesheet" href="./css/style.css" />
    <link rel="icon" href="./assets/icon/favicon-32x32.png" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
  </head>

  <body>
    <div id="cadastroUser" class="cadastro">
      <div class="alerta_erro">
        <div class="card_erro" id="cardErro">
        <span id="mensagem_erro"></span>
        </div>
        </div>


      <div class="banner-img">
        <img src="./assets/imgs/banner-cadastro.png" alt="" />
      </div>
      <div class="container-features">
        <h1>CADASTRO</h1>
        <div class="inputs">
          <p>Nome</p>
          <input
            placeholder="Seu Nome"
            class="input-cadastro"
            type="text"
            id="nome_input"
          />
          <p>Email</p>
          <input
            placeholder="seuemail@gmail.com"
            class="input-cadastro"
            type="text"
            id="email_input"
          />
          <p>Senha</p>
          <input
            placeholder="........"
            class="input-cadastro"
            type="password"
            id="senha_input"
          />
          <p>Confirme Sua senha</p>
          <input
            placeholder="........"
            class="input-cadastro"
            type="password"
            id="confirmacao_senha_input"
          />
          <p>Qual Classe você se identifica</p>
          <select name="" id="select_classe">
            <option selected disabled value="#">Selecione uma Opção</option>
            <option value="1">Bruxo</option>
            <option value="3">Feiticeira</option>
            <option value="2">Bardo</option>
            <option value="4">Nobre</option>
            <option value="5">Criminoso</option>
          </select>
          <div class="button">
            <a href="">ja tenho login</a>
            <button onclick="cadastrar()">Cadastrar</button>
          </div>

          
          
            <div id="div_erros_login"></div>
          </div>
        </div>
      </div>
    </div>









    <!--AQUI INICIA A PARTE 2 DO CADASTRO!!!!--->

    <div id="about_user" class="about-user">
    <div class="reference-img-abt-user">
        <img src="./assets/imgs/bg-about-user.png" alt="" />
    </div>

    <div class="container-abt-user">
        <div class="title">NOS CONTE UM POUCO SOBRE A SUA <br />EXPERIÊNCIA PARA SE CADASTRAR</div>

        <div class="container-quest-abt-user">
            <div class="box-quest-abt">
                <div class="opcoes-abt">
                    <p>como você conheceu The Witcher</p>
                    <span>
                      <input type="radio" id="conheceu_livros" name="origemConhecimento" class="radio" value="Livros" />Os Livros de Andrej Sapkowski
                      <label for="conheceu_livros" class="option"></label>
                    </span>

                    <span>
                      <input type="radio" id="conheceu_tw3" name="origemConhecimento" class="radio" value="Witcher3" />The Witcher 3 Wild Hunt
                      <label for="conheceu_tw3" class="option"></label>
                    </span>

                    <span>
                      <input type="radio" id="conheceu_tw12" name="origemConhecimento" class="radio" value="Witcher1ou2" />The Witcher 1 ou 2
                      <label for="conheceu_tw12" class="option"></label>
                    </span>

                    <span>
                      <input type="radio" id="conheceu_serie" name="origemConhecimento" class="radio" value="Serie" />A Série
                      <label for="conheceu_serie" class="option"></label>
                    </span>

                    <span>
                      <input type="radio" id="conheceu_gwent" name="origemConhecimento" class="radio" value="Gwent" />Gwent
                      <label for="conheceu_gwent" class="option"></label>
                    </span>
                </div>
            </div>

            <div class="box-quest-abt">
                <div class="opcoes-abt">
                    <p>O destino te liga a um personagem</p>
                    <span>
                      <input type="radio" id="pers_geralt" name="personagemFavorito" class="radio" value="Geralt" />Geralt de Rívia
                      <label for="pers_geralt" class="option"></label>
                    </span>

                    <span>
                      <input type="radio" id="pers_ciri" name="personagemFavorito" class="radio" value="Ciri" />Ciri
                      <label for="pers_ciri" class="option"></label>
                    </span>

                    <span>
                      <input type="radio" id="pers_yennefer" name="personagemFavorito" class="radio" value="Yennefer" />Yennefer de Vengerberg
                      <label for="pers_yennefer" class="option"></label>
                    </span>

                    <span>
                      <input type="radio" id="pers_jaskier" name="personagemFavorito" class="radio" value="Jaskier" />Jaskier
                      <label for="pers_jaskier" class="option"></label>
                    </span>

                    <span>
                      <input type="radio" id="pers_triss" name="personagemFavorito" class="radio" value="Triss" />Triss Merigold
                      <label for="pers_triss" class="option"></label>
                    </span>
                </div>
            </div>
        </div>

        <div class="container-quest-abt-user">
            <div class="box-quest-abt">
                <div class="opcoes-abt">
                    <p>O que você espera do Site</p>
                    <span>
                      <input type="radio" id="espera_bestiario" name="esperaSite" class="radio" value="Bestiario" />Ver um bestiário
                      <label for="espera_bestiario" class="option"></label>
                    </span>

                    <span>
                      <input type="radio" id="espera_lore" name="esperaSite" class="radio" value="Lore" />Explorar a lore
                      <label for="espera_lore" class="option"></label>
                    </span>

                    <span>
                      <input type="radio" id="espera_personagens" name="esperaSite" class="radio" value="Personagens" />Ver os Personagens
                      <label for="espera_personagens" class="option"></label>
                    </span>

                    <span>
                      <input type="radio" id="espera_quiz" name="esperaSite" class="radio" value="Quiz" />Fazer Quiz
                      <label for="espera_quiz" class="option"></label>
                    </span>

                    <span>
                      <input type="radio" id="espera_outros" name="esperaSite" class="radio" value="Outros" />Outros
                      <label for="espera_outros" class="option"></label>
                    </span>
                </div>
            </div>

            <div class="box-quest-abt">
                <div class="opcoes-abt">
                    <p>Qual seu sinal favorito</p>
                    <span>
                      <input type="radio" id="sinal_aard" name="sinalFavorito" class="radio" value="Aard" />Aard
                      <label for="sinal_aard" class="option"></label>
                    </span>

                    <span>
                      <input type="radio" id="sinal_igni" name="sinalFavorito" class="radio" value="Igni" />Igni
                      <label for="sinal_igni" class="option"></label>
                    </span>

                    <span>
                      <input type="radio" id="sinal_yrden" name="sinalFavorito" class="radio" value="Yrden" />Yrden
                      <label for="sinal_yrden" class="option" ></label>
                    </span>

                    <span>
                      <input type="radio" id="sinal_quen" name="sinalFavorito" class="radio" value="Quen" />Quen
                      <label for="sinal_quen" class="option"></label>
                    </span>

                    <span>
                      <input type="radio" id="sinal_axii" name="sinalFavorito" class="radio" value="Axii" />Axii
                      <label for="sinal_axii" class="option"></label>
                    </span>
                </div>
            </div>
        </div>

        <div class="button-abt-user">
            <button onclick="cadastrarSobre()">Próximo</button>
        </div>
    </div>
</div>


  </body>
</html>

<script>
  // Array para armazenar empresas cadastradas para validação de código de ativação
  sessionStorage.ORIGEM = ''
    sessionStorage.PERSONAGEM = ''
    sessionStorage.SITE = ''
    sessionStorage.SINAL = ''

    function cadastrarSobre(){


    var origem = document.querySelector('input[name="origemConhecimento"]:checked');
    var personagem = document.querySelector('input[name="personagemFavorito"]:checked');
    var site = document.querySelector('input[name="esperaSite"]:checked');
    var sinal = document.querySelector('input[name="sinalFavorito"]:checked');


    //if pra verificar se o valor existe pra pegar e se não é nulo (ele começa null)
    var origemVar = null; 
    if (origem) {
        origemVar = origem.value;
    }

    var personagemVar = null;
    if (personagem) {
        personagemVar = personagem.value;
    }

    var siteVar = null;
    if (site) {
        siteVar = site.value;
    }
    
    var sinalVar = null;
    if (sinal) {
        sinalVar = sinal.value;
    }


    if (!origemVar || !personagemVar || !siteVar || !sinalVar) {
        alert("Por favor, responda todas as perguntas para continuar!");
        
        console.log('EI TEM Q BOTAR TODOAS AS PERGUNTAS')
        return;
    }

    sessionStorage.ORIGEM = origemVar
    sessionStorage.PERSONAGEM = personagemVar
    sessionStorage.SITE = siteVar
    sessionStorage.SINAL = sinalVar

    cadastroUser.style.display = "flex";
    about_user.style.display = "none";

  }



  function cadastrar() {


    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var nomeVar = nome_input.value;
    var emailVar = email_input.value;
    var senhaVar = senha_input.value;
    var confirmacaoSenhaVar = confirmacao_senha_input.value;
    var fkClasseVar = select_classe.value

    // Verificando se há algum campo em branco
    if (
      nomeVar == "" ||
      emailVar == "" ||
      senhaVar == "" ||
      confirmacaoSenhaVar == ""||
      fkClasseVar == "#"
    ) {
      cardErro.style.display = "block";
      mensagem_erro.innerHTML =
        "(Mensagem de erro para todos os campos em branco)";

      finalizarAguardar();
      return false;
    } else {
      setInterval(sumirMensagem, 5000);
    }

    // Verificando se o código de ativação é de alguma empresa cadastrada


    // Enviando o valor da nova input
    fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        nomeServer: nomeVar,
        emailServer: emailVar,
        senhaServer: senhaVar,
        fkClasseServer: fkClasseVar, 
        origemServer: sessionStorage.ORIGEM,
        personagemServer: sessionStorage.PERSONAGEM,
        siteServer: sessionStorage.SITE, 
        sinalServer: sessionStorage.SINAL,
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          cardErro.style.display = "block";

          mensagem_erro.innerHTML =
            "Cadastro realizado com sucesso! Agora falta o Sobre...";

          setTimeout(() => {
            window.location = "login.html";
          }, "2000");

          limparFormulario();
          finalizarAguardar();
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        finalizarAguardar();
      });

    return false;
  }


  

  
  // Listando empresas cadastradas

  function sumirMensagem() {
    cardErro.style.display = "none";
  }
</script>

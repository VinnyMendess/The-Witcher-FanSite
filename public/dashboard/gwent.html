<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="gwent.css" />
    <link rel="icon" href="../assets/icon/favicon-32x32.png" />
    <title>Document</title>
  </head>
  <body class="gwent">
    <aside>
      <div class="player">
        <div class="box-oponent">
          <div class="img-oponent">
            <img src="../assets/icon/icon-wild-hunt.png" alt="" />
          </div>
          <div class="text-oponent">
            <p class="title">Oponente</p>
            <p>Northern Realms</p>
          </div>
          <div class="features-oponent">
            <div id="div_exibir_total"></div>
            <div class="life-oponent"></div>
            <div id="exibir_pontos_adversario" class="points-game"></div>
          </div>
        </div>
      </div>

      <div class="player">
        <div class="box-oponent">
          <div class="img-oponent">
            <img src="../assets/icon/geralt-icon.jpg" alt="" />
          </div>
          <div class="text-oponent">
            <p class="title" id="nome"></p>
            <p>Northern Realms</p>
          </div>
          <div class="features-player">
            <div class="life-oponent"></div>
            <div id="exibir_pontos_jogador" class="points-game"></div>
          </div>
        </div>
      </div>

      <div id="div_exibir_passou"></div>
    </aside>

    <div class="container-table">
      <div id="div_exibir_ad" class="box-cartas-adversario"></div>
      <div id="div_mesa_distancia_ad" class="mesa-distancia"></div>
      <div id="div_mesa_corpo_ad" class="mesa-distancia"></div>
      <div id="div_mesa_corpo_jv" class="mesa-distancia"></div>
      <div id="div_mesa_distancia_jv" class="mesa-distancia">
        <div class="icon-mesa"></div>
      </div>
      <div id="div_exibir_jv" class="box-cartas-jogador"></div>
    </div>

    <div class="direita-mesa">
      <div class="vidas-adversario">
        <div id="vida_j0" class="vida-0">
          <img src="../assets/imgs/life-1.png" alt="" />
        </div>
        <div id="vida_j1" class="vida-1">
          <img src="../assets/imgs/life-1.png" alt="" />
        </div>
        <div id="vida_j2" class="vida-2">
          <img src="../assets/imgs/life-0.png" alt="" />
        </div>
        <div id="vida_j3" class="vida-3">
          <img src="../assets/imgs/life-0.png" alt="" />
        </div>
      </div>
      <div class="buttons-acao">
        <button onclick="passarTurno()">
          Passar<br />
          Turno
        </button>
        <button onclick="encerrarTurno()">
          Encerrar<br />
          Turno
        </button>
        <button id="btnReorganizar" onclick="iniciarMulligan()">
          Reorganizar <br />( <span id="mulliganCount">0</span> )
        </button>
      </div>

      <div class="vidas-adversario">
        <div class="title"><p>Sua Vida</p></div>
        <div id="vida_a0" class="vida-0">
          <img src="../assets/imgs/life-1.png" alt="" />
        </div>
        <div id="vida_a1" class="vida-1">
          <img src="../assets/imgs/life-1.png" alt="" />
        </div>
        <div id="vida_a2" class="vida-2">
          <img src="../assets/imgs/life-0.png" alt="" />
        </div>
        <div id="vida_a3" class="vida-3">
          <img src="../assets/imgs/life-0.png" alt="" />
        </div>
      </div>
    </div>
  </body>
</html>
<script>
  nomeJogador = sessionStorage.NOME_USUARIO;

  nome.innerHTML = nomeJogador;

  jogadorAtual = "jogador";
  jogadorPassou = false;
  adversarioPassou = false;

  vidasJogador = 2;
  vidasAdversario = 2;

  maoJogador = [];
  campoDeBatalha = [];
  maoAdversario = [];
  ataqueCarta = [];
  pontuacaoAdversario = [];

  //campos de batalhas do jogador
  campoCorpoJogador = [];
  campoDistanciaJogador = [];

  //campos de batalhas do Oponente
  campoCorpoAdversario = [];
  campoDistanciaAdversario = [];

  baralhoDeCompra = []
   cartasParaComprar = [];
   
  mulligansRestantes = 0;
  rodadaAtual = 1;

  var mensagem_ad = "";
  var mensagem_jv = "";

  // bonus 1: è normal e aumenta em 1
  // bonus 2: è rara e aumenta em 2
  // bonus 3: è lendária e aumenta em 5

  const cartasBase = [
    // Heróis (Rara: Bônus5)
    {
      nome: "Geralt de Rivia",
      atk: 15,
      caminhoImagem: "../assets/Gwent-Cards/geralt-gwent.webp",
      tipo: "corpo",
      habilidade: "bonus5",
    },
    {
      nome: "Cirila Fiona Elen Riannon",
      atk: 15,
      caminhoImagem: "../assets/Gwent-Cards/ciri-gwent.png",
      tipo: "corpo",
      habilidade: "bonus5",
    }, // Bônus 2
    {
      nome: "Yennefer de Vengerberg",
      atk: 7,
      caminhoImagem: "../assets/Gwent-Cards/yennefer-gwent.png",
      tipo: "distancia",
      habilidade: "bonus2",
    },
    {
      nome: "Triss Merigold",
      atk: 7,
      caminhoImagem: "../assets/Gwent-Cards/triss-gwent.webp",
      tipo: "corpo",
      habilidade: "bonus2",
    },
    {
      nome: "Foltest, O Ardente",
      atk: 10,
      caminhoImagem: "../assets/Gwent-Cards/foltest-gwent.webp",
      tipo: "corpo",
      habilidade: "bonus2",
    },
    {
      nome: "Ves",
      atk: 5,
      caminhoImagem: "../assets/Gwent-Cards/ves-gwent.png",
      tipo: "corpo",
      habilidade: "bonus2",
    },
    {
      nome: "Black Infantry Archer",
      atk: 10,
      caminhoImagem: "../assets/Gwent-Cards/infanrty-gwent.webp",
      tipo: "distancia",
      habilidade: "bonus2",
    },
    {
      nome: "Balista",
      atk: 6,
      caminhoImagem: "../assets/Gwent-Cards/balista-gwent.webp",
      tipo: "cerco",
      habilidade: "bonus2",
    },
    {
      nome: "Trebuchet",
      atk: 6,
      caminhoImagem: "../assets/Gwent-Cards/trebuchet.webp",
      tipo: "cerco",
      habilidade: "bonus2",
    },
    {
      nome: "Vesemir",
      atk: 6,
      caminhoImagem: "../assets/Gwent-Cards/vesemir-gwent.png",
      tipo: "corpo",
      habilidade: "bonus2",
    },
    {
      nome: "Zoltan",
      atk: 5,
      caminhoImagem: "../assets/Gwent-Cards/zoltan-gwent.png",
      tipo: "corpo",
      habilidade: "bonus2",
    },
    {
      nome: "Infantry Archer",
      atk: 10,
      caminhoImagem: "../assets/Gwent-Cards/infantry-archer-gwent.png",
      tipo: "distancia",
      habilidade: "bonus2",
    }, // Bônus 1

    {
      nome: "Schirru",
      atk: 5,
      caminhoImagem: "../assets/Gwent-Cards/schirru-gwent.webp",
      tipo: "cerco",
      habilidade: "bonus1",
    },
    {
      nome: "Milva",
      atk: 5,
      caminhoImagem: "../assets/Gwent-Cards/milva-gwent.webp",
      tipo: "distancia",
      habilidade: "bonus1",
    },
    {
      nome: "Keira Metz",
      atk: 5,
      caminhoImagem: "../assets/Gwent-Cards/keira-gwent.webp",
      tipo: "distancia",
      habilidade: "bonus1",
    },
    {
      nome: "Cynthia",
      atk: 4,
      caminhoImagem: "../assets/Gwent-Cards/cynthia-gwent.webp",
      tipo: "distancia",
      habilidade: "bonus1",
    },
    {
      nome: "Redanian Foot Soldier",
      atk: 1,
      caminhoImagem: "../assets/Gwent-Cards/redanian-gwent.webp",
      tipo: "corpo",
      habilidade: "bonus1",
    },
    {
      nome: "Impéria Brigade Guard",
      atk: 3,
      caminhoImagem: "../assets/Gwent-Cards/impera-guard-gwent.webp",
      tipo: "corpo",
      habilidade: "bonus1",
    },
    {
      nome: "Don Banner Medic",
      atk: 5,
      caminhoImagem: "../assets/Gwent-Cards/medic-gwent.webp",
      tipo: "cerco",
      habilidade: "bonus1",
    },
    {
      nome: "Unidade de Suporte",
      atk: 4,
      caminhoImagem: "../assets/Gwent-Cards/mysterious-gwent.webp",
      tipo: "cerco",
      habilidade: "bonus1",
    },
    {
      nome: "Espiã Oculta",
      atk: 0,
      caminhoImagem: "../assets/Gwent-Cards/mysterious-gwent.webp",
      tipo: "distancia",
      habilidade: "bonus1",
    },
    {
      nome: "Soldado Auxiliar I",
      atk: 1,
      caminhoImagem: "../assets/Gwent-Cards/redanian-gwent.webp",
      tipo: "corpo",
      habilidade: "bonus1",
    },
    {
      nome: "Soldado Auxiliar II",
      atk: 1,
      caminhoImagem: "../assets/Gwent-Cards/redanian-gwent.webp",
      tipo: "corpo",
      habilidade: "bonus1",
    },
    {
      nome: "Vesemir",
      atk: 2,
      caminhoImagem: "../assets/Gwent-Cards/dandelion-gwent.png",
      tipo: "corpo",
      habilidade: "bonus1",
    },
    {
      nome: "Vesemir",
      atk: 6,
      caminhoImagem: "../assets/Gwent-Cards/elemental-gwent.png",
      tipo: "cerco",
      habilidade: "bonus1",
    },
    {
      nome: "ghoul",
      atk: 1,
      caminhoImagem: "../assets/Gwent-Cards/ghoul-gwent.png",
      tipo: "corpo",
      habilidade: "bonus1",
    },
    {
      nome: "ghoul-2",
      atk: 1,
      caminhoImagem: "../assets/Gwent-Cards/ghoul-2-gwent.png",
      tipo: "corpo",
      habilidade: "bonus1",
    },
    {
      nome: "Infantry Archer",
      atk: 10,
      caminhoImagem: "../assets/Gwent-Cards/infantry-archer-2-gwent.png",
      tipo: "distancia",
      habilidade: "bonus1",
    },
    {
      nome: "gargoyle",
      atk: 2,
      caminhoImagem: "../assets/Gwent-Cards/gargoyle-gwent.png",
      tipo: "distancia",
      habilidade: "bonus1",
    },
    {
      nome: "foglet",
      atk: 2,
      caminhoImagem: "../assets/Gwent-Cards/foglet-gwent.png",
      tipo: "corpo",
      habilidade: "bonus1",
    },
    {
      nome: "wyvern",
      atk: 1,
      caminhoImagem: "../assets/Gwent-Cards/wyvern-gwent.png",
      tipo: "distancia",
      habilidade: "bonus1",
    },
    {
      nome: "siege tower",
      atk: 6,
      caminhoImagem: "../assets/Gwent-Cards/siege-tower-gwent.png",
      tipo: "cerco",
      habilidade: "bonus1",
    },
    {
      nome: "denesle",
      atk: 5,
      caminhoImagem: "../assets/Gwent-Cards/densesle-gwent.png",
      tipo: "corpo",
      habilidade: "bonus1",
    },
    {
      nome: "catapult",
      atk: 8,
      caminhoImagem: "../assets/Gwent-Cards/catapult-gwent.png",
      tipo: "cerco",
      habilidade: "bonus1",
    },
    {
      nome: "siege",
      atk: 0,
      caminhoImagem: "../assets/Gwent-Cards/siege-gwent.png",
      tipo: "cerco",
      habilidade: "bonus1",
    },
    {
      nome: "etolian",
      atk: 1,
      caminhoImagem: "../assets/Gwent-Cards/etolian-gwent.png",
      tipo: "distancia",
      habilidade: "bonus1",
    },
  ];

  function inicializarJogo() {
    maoJogador = [];
    campoDeBatalha = [];
    maoAdversario = [];
    baralhoDeCompra = [];
   

    campoCorpoJogador = [];
    campoDistanciaJogador = [];

    campoCorpoAdversario = [];
    campoDistanciaAdversario = [];
    vidasJogador = 2;
    vidasAdversario = 2;

    var baralhoCompleto = [...cartasBase];

    //recebe o baralho como parametro e usa na funçao embaralhar
    embaralhar(baralhoCompleto);

    var cartasPorJogador = 10;
    //distribuindo as cartas de fortma aleatória, a mao do jogador começa com 10
    maoJogador = baralhoCompleto.slice(0, cartasPorJogador);
    //mesma coisa mas ele pega o restante
    maoAdversario = baralhoCompleto.slice(
      cartasPorJogador,
      cartasPorJogador * 2
    );

    baralhoDeCompra = baralhoCompleto.slice(cartasPorJogador * 2)

    percorrerAdversario();
    percorrerJogador();
    // atualizarCampoBatalha();
    calcularPontuacaoTotal();

    // div_exibir_tg.innerHTML =
    //   '<p style="color: #ccc;">Cartas jogadas aparecerão aqui.</p>';
    rodadaAtual = 1;
    mulligansRestantes = 2;
    atualizarMulliganDisplay();
    alert(
      "O jogo foi iniciado! Jogue sua primeira carta e as cartas embaralhadas. Você pode reoganizar até 2 cartas"
    );
  }

  //embaralha o vetor
  function embaralhar(vetor) {
    var indiceAtual = vetor.length;
    var valorTemporario;
    var indiceAleatorio;

    //verifica se tem mais itens para embaralhar
    while (indiceAtual != 0) {
      indiceAleatorio = Math.floor(Math.random() * indiceAtual);
      indiceAtual--;

      //faz as trocas
      valorTemporario = vetor[indiceAtual];
      vetor[indiceAtual] = vetor[indiceAleatorio];
      vetor[indiceAleatorio] = valorTemporario;
    }
    return vetor;
  }

  function aplicarEfeitoBonus(carta, jogador) {
    var bonus = 0;
    if (carta.habilidade == "bonus1") {
      bonus = 1;
    } else if (carta.habilidade == "bonus2") {
      bonus = 2;
    } else if (carta.habilidade == "bonus5") {
      bonus = 5;
    }

    if (bonus > 0) {
      carta.atk += bonus;
      alert(`Carta ${carta.nome} (${jogador}) ativou Bônus: +${bonus} ATK!`);
    }
  }

  function jogarCartaAdversario(indice) {
    if (maoAdversario.length === 0) {
      return;
    }
    indice = indice === undefined ? 0 : indice;
    if (indice < 0 || indice >= maoAdversario.length) {
      return;
    }

    var cartaJogada = maoAdversario[indice];

    aplicarEfeitoBonus(cartaJogada, "Adversario");

    maoAdversario.splice(indice, 1); // Remove da mão

    var tipo = cartaJogada.tipo;

    if (tipo == "corpo") {
      campoCorpoAdversario.push(cartaJogada);
    } else if (tipo == "distancia" || tipo == "cerco") {
      campoDistanciaAdversario.push(cartaJogada);
    } else {
      //tirar isso depois
      campoCorpoAdversario.push(cartaJogada);
    }
    // campoDeBatalha.push(cartaJogada); // Adiciona ao campo

    percorrerAdversario(); // Atualiza a mão do adversário
    // atualizarCampoBatalha();
    calcularPontuacaoTotal();
  }

  function passarTurno() {
    if (jogadorPassou) {
      alert("Você passou");
      return;
    }

    jogadorPassou = true;
    atualizarMulliganDisplay();

    if (adversarioPassou) {
      encerrarTurno();
    } else {
      jogadorAtual = "adversario";
      alert("Jogador Passou, agora é o oponente");
      setTimeout(turnoAdversario, 1000);
    }
  }

  function jogarCartaJogador(indice) {
    //verificação pra saber se ele ja jogou
    // if(jogadorAtual != 'jogador '|| jogadorPassou){
    //   alert('Não é seu turno você já passou patrão')
    //   return
    // }

    if (jogadorPassou) {
      alert("Você já passou a vez e não pode jogar cartas.");
      return;
    }

    if (indice < 0 || indice >= maoJogador.length) {
      alert("Essa carta ta inválida");
      return;
    }

    // if(cartaJogada.habilidade == 'bonus'){
    //   cartaJogada.atk += 1;
    //   alert(`Carta ${cartaJogada.nome} ativou Bônus: +1 ATK!`)
    // }

    var cartaJogada = maoJogador[indice];
    aplicarEfeitoBonus(cartaJogada, "Jogador");

    var nome = cartaJogada.nome;
    var ataque = cartaJogada.atk;
    var tipo = cartaJogada.tipo;

    maoJogador.splice(indice, 1);

    //Verificar qual carta ele jogou para selecionar a mesa:
    if (tipo == "corpo") {
      campoCorpoJogador.push(cartaJogada);
    } else if (tipo == "distancia" || tipo == "cerco") {
      campoDistanciaJogador.push(cartaJogada);
    } else {
      //tirar isso depois
      campoCorpoAdversario.push(cartaJogada);
    }

    mulligansRestantes = 0;
     atualizarMulliganDisplay();
    // campoDeBatalha.push(cartaJogada);

    //div_exibir_tg.innerHTML += `<div style="background-Color: blue;" class="card-item">${nome} (${ataque} ATK)</div>`
    // atualizarCampoBatalha();

    exibirCorpoJogador();
    exibirDistanciaJogador();
    calcularPontuacaoTotal();
    percorrerJogador();

    jogadorAtual = "adversario";
    setTimeout(turnoAdversario, 1000);
    // jogarCartaAdversario(indiceAdversario);
  }

  function turnoAdversario() {
    if (adversarioPassou) {
      //se o cabra passou n fazer nada
      jogadorAtual = "jogador";
      return;
    }

    var pontuacoes = calcularPontuacaoTotal();
    var diferenca = pontuacoes.jogador - pontuacoes.adversario;

    //pouca chance de agressividade pra jogar mesmo perdendo por poucpo
    const agressividade = Math.random();
    //passa se a mão acabou OU o jogador passou OU a diferença de pontos é muito grande  ou seja maior que 20 OU ele tem poucas cardtas <=2 ou ele falhou no teste de agressividade
    if (
      maoAdversario.length == 0 ||
      (jogadorPassou &&
        (diferenca > 20 || maoAdversario.length <= 2 || agressividade < 0.7))
    ) {
      adversarioPassou = true;
      alert("Oponente passou");
      encerrarTurno();
      return;
    }

    //se ele não passar ele joga alguma carta
    var indiceAdversario = Math.floor(Math.random() * maoAdversario.length);
    jogarCartaAdversario(indiceAdversario);

    exibirCorpoAdversario();
    exibirDistanciaAdversario();
    calcularPontuacaoTotal();

    if (!jogadorPassou) {
      jogadorAtual = "jogador";
    } else {
      //se o jogador passar e o adversario jogou, o adversario continua jogando
      setTimeout(turnoAdversario, 1000);
    }
  }

  // FUNÇÔES DE EXIBIXÃO JOGADOR

  function exibirCorpoJogador() {
    div_mesa_corpo_jv.innerHTML = "";
    for (let i = 0; i < campoCorpoJogador.length; i++) {
      var cartaJogada = campoCorpoJogador[i];
      var nome = cartaJogada.nome;
      var ataque = cartaJogada.atk;
      var caminhoImagem = cartaJogada.caminhoImagem;

      div_mesa_corpo_jv.innerHTML += `<div class="card-item campo"><img id="card-img" src="${caminhoImagem}" alt="${nome}"><div id="card-bg-atk"><span id="card-atk">${ataque}</span></div></div>`;
    }
  }
  function exibirDistanciaJogador() {
    div_mesa_distancia_jv.innerHTML = "";
    for (let i = 0; i < campoDistanciaJogador.length; i++) {
      var cartaJogada = campoDistanciaJogador[i];
      var nome = cartaJogada.nome;
      var ataque = cartaJogada.atk;
      var caminhoImagem = cartaJogada.caminhoImagem;

      div_mesa_distancia_jv.innerHTML += `<div class="card-item campo"><img id="card-img" src="${caminhoImagem}" alt="${nome}"><div id="card-bg-atk"><span id="card-atk">${ataque}</span></div></div>`;
    }
  }

  // ADV
  function exibirCorpoAdversario() {
    div_mesa_corpo_ad.innerHTML = "";
    for (let i = 0; i < campoCorpoAdversario.length; i++) {
      var cartaJogada = campoCorpoAdversario[i];
      var nome = cartaJogada.nome;
      var ataque = cartaJogada.atk;
      var caminhoImagem = cartaJogada.caminhoImagem;

      div_mesa_corpo_ad.innerHTML += `<div class="card-item campo"><img id="card-img" src="${caminhoImagem}" alt="${nome}"><div id="card-bg-atk"><span id="card-atk">${ataque}</span></div></div>`;
    }
  }
  function exibirDistanciaAdversario() {
    div_mesa_distancia_ad.innerHTML = "";
    for (let i = 0; i < campoDistanciaAdversario.length; i++) {
      var cartaJogada = campoDistanciaAdversario[i];
      var nome = cartaJogada.nome;
      var ataque = cartaJogada.atk;
      var caminhoImagem = cartaJogada.caminhoImagem;

      div_mesa_distancia_ad.innerHTML += `<div class="card-item campo"><img id="card-img" src="${caminhoImagem}" alt="${nome}"><div id="card-bg-atk"><span id="card-atk">${ataque}</span></div></div>`;
    }
  }

  // function atualizarCampoBatalha() {
  //   div_exibir_tg.innerHTML = "";
  //   for (let i = 0; i < campoDeBatalha.length; i++) {
  //     var cartaJogada = campoDeBatalha[i];
  //     var nome = cartaJogada[0];
  //     var ataque = cartaJogada[1];
  //     var caminhoImagem = cartaJogada[2];

  //     div_exibir_tg.innerHTML += `<div class="card-item campo"><img src="${caminhoImagem}" alt="${nome}"></div>`;
  //   }
  // }

  function percorrerJogador() {
    mensagem_jv = "";

    for (let i = 0; i < maoJogador.length; i++) {
      var cartaAtual = maoJogador[i];

      var nomeCarta = cartaAtual.nome;
      var ataqueCarta = cartaAtual.atk;
      //var descricaoCarta = cartaAtual[2];
      //var pontuacaoJogador = cartaAtual[1];
      var caminhoImagem = cartaAtual.caminhoImagem;
      //para adicionar as fotinhos das cartas
      mensagem_jv += `
    <button onclick="jogarCartaJogador(${i})">
        <div class="card-item">
            <img src="${caminhoImagem}" alt="${nomeCarta}">
        </div>
    </button>
`;
    }

    div_exibir_jv.innerHTML = mensagem_jv;
  }
  function percorrerAdversario() {
    mensagem_ad = "";
    for (let i = 0; i < maoAdversario.length; i++) {
      cartaAtual = maoAdversario[i];

      nomeCarta = cartaAtual.nome;
      ataqueCarta = cartaAtual.atk;
      var caminhoImagem = "../assets/Gwent-Cards/card-invertida.png";
      mensagem_ad += `
        <div class="card-item">
            <img src="${caminhoImagem}" alt="${nomeCarta}">
        </div>
`;
    }
    div_exibir_ad.innerHTML = `${maoAdversario.length} ` + mensagem_ad;
  }

  function encerrarTurno() {
    //if pra ver se ambos passaram ou se as mão acabaram
    console.log("Cheguei no encerrar turno");
    if (!jogadorPassou || !adversarioPassou) {
      //se ambos os jogadores não passaram, as maãos não acabara e não encerra
      //se passar da validação ele vai sair da função
      // no final de tudo ele força o encerramento caso ambos passem
      return;
    }

    var pontuacoes = calcularPontuacaoTotal();
    var vitoria = "";

    if (pontuacoes.jogador > pontuacoes.adversario) {
      //Vitoria do Jogador e o adversario perde 1 vida
      vitoria = "Jogador";
      vidasAdversario--;
    } else if (pontuacoes.adversario > pontuacoes.jogador) {
      vitoria = "Adversario";
      vidasJogador--;
    } else {
      vitoria = "Empate";
      vidasJogador--;
      vidasAdversario--;
    }

    alert(
      `Rodada Encerada! Vencedor ${vitoria}. Placar ${pontuacoes.jogador} X ${pontuacoes.adversario}`
    );
    atualizarExibicaoVidas();
    verificarFimJogo();

    if (vidasJogador > 0 && vidasAdversario > 0) {
      reiniciarRodada();
    }
  }

  function reiniciarRodada() {
    jogadorPassou = false;
    adversarioPassou = false;
    jogadorAtual = "jogador"; // JOgador sempre começa

    //limpando os campos
    campoCorpoJogador = [];
    campoDistanciaJogador = [];
    campoCorpoAdversario = [];
    campoDistanciaAdversario = [];

    exibirCorpoJogador();
    exibirDistanciaJogador();
    exibirCorpoAdversario();
    exibirDistanciaAdversario();

    var cartasParaComprar = 3;

    var cartasCompradasJogador = baralhoDeCompra.splice(0, cartasParaComprar);
    maoJogador.push(...cartasCompradasJogador);
    
    var cartasCompradasAdversario = baralhoDeCompra.splice(0, cartasParaComprar);
    maoAdversario.push(...cartasCompradasAdversario);
    
    var cartasCompradasTotal = cartasCompradasJogador.length;

    //deifinido que só tem 1 mulligans restante
    rodadaAtual++;
    mulligansRestantes = 1;
    atualizarMulliganDisplay();

    //As mãos permanecem com as cartas que sobraram
    percorrerJogador();
    percorrerAdversario();
    calcularPontuacaoTotal();

   if (cartasCompradasTotal > 0) {
    alert(`Nova rodada iniciada. ${cartasCompradasTotal} cartas adicionadas à sua mão Você pode reorganizar até 1 carta.`);
} else {
    alert("Nova rodada iniciada. O baralho de compra está vazio. Você pode reorganizar até 1 carta.");
}
  }

  function atualizarMulliganDisplay() {
    const countSpan = document.getElementById("mulliganCount");
    const btn = document.getElementById("btnReorganizar");

    if (countSpan) {
      countSpan.innerHTML = mulligansRestantes;
    }

    if (btn) {
  //desativa o botão se mulligasn Restantes for <= OU se o jogador ja passou
     btn.disabled = mulligansRestantes <= 0 || jogadorPassou;
    }
  }

  function iniciarMulligan() {
    if (mulligansRestantes <= 0) {
      alert("Você não tem reorganizações restantes.");
      return;
    }
    if (
      jogadorPassou ||
      campoCorpoJogador.length > 0 ||
      campoDistanciaJogador.length > 0
    ) {
      alert("Você só pode reorganizar as cartas no início da rodada.");
      return;
    }

    alert(`Reorganizando ${mulligansRestantes} cartas  na mão`);
    embaralhar(maoJogador);

    mulligansRestantes--;

    percorrerJogador();
    atualizarMulliganDisplay();
    alert(
      `Mão reembaralhada. ${mulligansRestantes} trocas restantes nesta rodada.`
    );
  }

  //pega o vetor do campo do jogador pra somar os ataques
  function somarPontosCampo(campo) {
    var soma = 0;

    //percorrer o indice campo
    for (var i = 0; i < campo.length; i++) {
      soma += campo[i].atk;
    }

    //Eu uso o return pra usar o resultado na função q calcula o total
    return soma;
  }

  function calcularPontuacaoTotal() {
    //passando o indice de cada campo e somando o resultado dele
    var pontuacaoJogador =
      somarPontosCampo(campoCorpoJogador) +
      somarPontosCampo(campoDistanciaJogador);
    var pontuacaoAdversario =
      somarPontosCampo(campoCorpoAdversario) +
      somarPontosCampo(campoDistanciaAdversario);

    exibir_pontos_jogador.innerHTML = pontuacaoJogador;
    exibir_pontos_adversario.innerHTML = pontuacaoAdversario;

    // div_exibir_total.innerHTML = `
    // <h3>Pontuação Total:</h3><p>Jogador: ${pontuacaoJogador}</p> <p>Adversario: ${pontuacaoAdversario}</p>
    // `;
    return { jogador: pontuacaoJogador, adversario: pontuacaoAdversario };
  }

  function verificarFimJogo() {
    if (vidasJogador <= 0 || vidasAdversario <= 0) {
      var vencedorFinal;

      if (vidasJogador > vidasAdversario) {
        vencedorFinal = sessionStorage.NOME_USUARIO;
      } else if (vidasAdversario > vidasJogador) {
        vencedorFinal = "ADVERSARIO";
      } else {
        vencedorFinal = "EMPATE";
      }

      alert(`O Jogo Acabou! O VENCEDOR FINAL é o ${vencedorFinal}!`);
      salvarJogo(vencedorFinal, vidasJogador, vidasAdversario);
    }
    //
  }

  function atualizarExibicaoVidas() {
    var vidaA_0 = document.getElementById("vida_j0").querySelector("img");
    var vidaA_1 = document.getElementById("vida_j1").querySelector("img");
    var vidaJ_0 = document.getElementById("vida_a0").querySelector("img");
    var vidaJ_1 = document.getElementById("vida_a1").querySelector("img"); // Adversário (A_0, A_1)
    
    if (vidasAdversario < 2) {
      if (vidaA_1) vidaA_1.src = "../assets/imgs/life-0.png";
    } else {
      if (vidaA_1) vidaA_1.src = "../assets/imgs/life-1.png";
    }
    if (vidasAdversario < 1) {
      if (vidaA_0) vidaA_0.src = "../assets/imgs/life-0.png";
    } else {
      if (vidaA_0) vidaA_0.src = "../assets/imgs/life-1.png";
    } // Jogador (J_0, J_1)
    if (vidasJogador < 2) {
      if (vidaJ_1) vidaJ_1.src = "../assets/imgs/life-0.png";
    } else {
      if (vidaJ_1) vidaJ_1.src = "../assets/imgs/life-1.png";
    }
    if (vidasJogador < 1) {
      if (vidaJ_0) vidaJ_0.src = "../assets/imgs/life-0.png";
    } else {
      if (vidaJ_0) vidaJ_0.src = "../assets/imgs/life-1.png";
    }
  }
  inicializarJogo();

  function salvarJogo(vencedor, vidasJogadorFinal, vidasAdversarioFinal) {
    fetch("/jogo/gwent", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        vencedorServer: vencedor,
        vidasJogadorFinalServer: vidasJogadorFinal,
        vidasAdversarioFinalServer: vidasAdversarioFinal,
        idUsuarioServer: sessionStorage.ID_USUARIO,
      }),
    })
    .then(function (resposta) {
        if (resposta.ok) {
            setTimeout(function () {
                window.location = "../dashboard/dash.html"; 
            }, 1500); 
        } 
        else {
             alert("Erro ao salvar a partida. Verifique o console.");
        }
    })
    
}
</script>
